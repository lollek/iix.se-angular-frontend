<p>N.B. This expects a working sendmail installation with STARTTLS</p>
<h2 id="install-cyrus-sasl">Install cyrus-sasl</h2>
<pre><code># install cyrus-sasl2
cd /usr/ports/security/cyrus-sasl2
make install clean
echo &quot;pwcheck_method: saslauthd&quot; &gt; /usr/local/lib/sasl2/Sendmail.conf

# install cyrus-sasl2-saslauthd
cd /usr/ports/security/cyrus-sasl2-saslauthd
make install clean
echo &#39;saslauthd_enable=&quot;YES&quot;&#39; &gt;&gt; /etc/rc.conf
service saslauthd start</code></pre>
<h2 id="set-sendmail-make-flags">Set sendmail make flags</h2>
<p>Set the following flags in /etc/make.conf (create if it doesn't exist)</p>
<pre><code>SENDMAIL_CFLAGS=-I/usr/local/include/sasl -DSASL
SENDMAIL_LDFLAGS=-L/usr/local/lib
SENDMAIL_LDADD=-lsasl2</code></pre>
<h2 id="recompile-sendmail">Recompile sendmail</h2>
<p>Did you have the source in /usr/src? Otherwise you will need to run<br />
the following command. If you don't use RELEASE-10, you should change that.</p>
<pre><code>svnlite checkout http://svn.freebsd.org/base/release/10.0.0/ /usr/src</code></pre>
<p>Now recompile sendmail</p>
<pre><code>cd /usr/src/lib/libsmutil
make cleandir &amp;&amp; make obj &amp;&amp; make
cd /usr/src/lib/libsm
make cleandir &amp;&amp; make obj &amp;&amp; make
cd /usr/src/usr.sbin/sendmail
make cleandir &amp;&amp; make obj &amp;&amp; make &amp;&amp; make install</code></pre>
<h2 id="do-some-config-switcheroo">Do some config switcheroo</h2>
<p>Fetch a sendmail config if you don't already have one</p>
<pre><code>cd /etc/mail
make</code></pre>
<p>Now you should have a your-hostname.mc file. If you DON'T want AUTH PLAIN,<br />
you can simply add the following lines</p>
<pre><code>dnl set SASL options
TRUST_AUTH_MECH(`GSSAPI DIGEST-MD5 CRAM-MD5 LOGIN&#39;)dnl
define(`confAUTH_MECHANISMS&#39;, `GSSAPI DIGEST-MD5 CRAM-MD5 LOGIN&#39;)dnl</code></pre>
<p>If you DO want AUTH PLAIN, add these instead</p>
<pre><code>dnl Set SASL options
dnl Only allow AUTH LOGIN PLAIN through STARTTLS and disallow anons
dnl
define(`confAUTH_OPTIONS&#39;, `A p y&#39;)dnl
TRUST_AUTH_MECH(`GSSAPI DIGEST-MD5 CRAM-MD5 LOGIN PLAIN&#39;)dnl
define(`confAUTH_MECHANISMS&#39;, `GSSAPI DIGEST-MD5 CRAM-MD5 LOGIN PLAIN&#39;)dnl</code></pre>
<p>Now install them and restart sendmail</p>
<pre><code>make install restart</code></pre>
